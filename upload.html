<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Upload Moments</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- MUSIC -->
<audio id="bgm" loop preload="auto">
  <source src="songg.mp3" type="audio/mpeg">
</audio>

<!-- NAVIGATION -->
<nav class="nav">
  <a href="index.html">Home</a>
  <a href="gallery.html">Gallery</a>
  <a href="upload.html" class="active">Upload</a>
  <a href="message.html">Pesan</a>
</nav>

<!-- BACKGROUND STAR ANIMATION -->
<div class="star-container">
  <div class="star" style="left:6%; animation-duration:6s;"></div>
  <div class="star" style="left:18%; animation-duration:7.2s; animation-delay:0.7s;"></div>
  <div class="star" style="left:32%; animation-duration:5.6s; animation-delay:0.2s;"></div>
  <div class="star" style="left:46%; animation-duration:8s; animation-delay:1.2s;"></div>
  <div class="star" style="left:60%; animation-duration:6.8s; animation-delay:0.4s;"></div>
  <div class="star" style="left:74%; animation-duration:7.6s; animation-delay:1.0s;"></div>
  <div class="star" style="left:88%; animation-duration:5.4s; animation-delay:0.6s;"></div>
</div>

<h2 class="neon-title">Upload ğŸ’™</h2>

<!-- UPLOAD UI -->
<div class="upload-box">
  <input type="file" id="fileInput">
  <button id="uploadBtn">Upload</button>
  <p id="status"></p>
  
  <div id="loader" style="display:none;margin-top:10px;color:#9cd6ff;font-size:15px;">
    â³ Mengupload...
  </div>
</div>

<!-- AUDIO CONTROL -->
<div class="audio-control">
  <button id="playBtn">Play Music</button>
  <button id="pauseBtn" style="display:none;">Pause</button>
</div>

<script type="module">
import { uploadPhoto } from "./supabase.js";

/* ====================== MUSIC AUTOPLAY (GESTURE) ====================== */
const bgm = document.getElementById("bgm");
const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
let unlocked = false;

function unlockMusic() {
  if (!unlocked) {
    bgm.play().then(() => {
      unlocked = true;
      playBtn.style.display = "none";
      pauseBtn.style.display = "inline-block";
    }).catch(() => {
      playBtn.style.display = "inline-block";
    });
  }
}

// gesture triggers
document.body.addEventListener("click", unlockMusic, { once:true });
document.body.addEventListener("scroll", unlockMusic, { once:true });
document.body.addEventListener("touchstart", unlockMusic, { once:true });

playBtn.onclick = () => unlockMusic();
pauseBtn.onclick = () => {
  bgm.pause();
  pauseBtn.style.display = "none";
  playBtn.style.display = "inline-block";
};

/* ====================== UPLOAD HANDLING ====================== */
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const statusMsg = document.getElementById("status");
const loader = document.getElementById("loader");

uploadBtn.onclick = async () => {
  const file = fileInput.files[0];

  if (!file) {
    statusMsg.textContent = "ğŸ“‚ Pilih file dulu ğŸ’™";
    return;
  }

  loader.style.display = "block";
  statusMsg.textContent = "";

  try {
    await uploadPhoto(file);
    loader.style.display = "none";
    statusMsg.textContent = "âœ¨ Berhasil upload! Cek di Gallery ğŸ’™";
    fileInput.value = "";
  } catch (err) {
    loader.style.display = "none";
    statusMsg.textContent = "âŒ Upload gagal, cek console";
    console.error(err);
  }
};
</script>

</body>
</html>
